这个是发生在自己模块的一次惨痛教训

### 故障描述
一次线上算不上很异常的请求，导致数据库一个任务表所有任务状态全部变成了关闭。

### 定位问题
在写业务代码时（代码是golang），golang的struct定义后，如果字符串没有传值，就是`" "`空字符串。然后一个update请求，绕过了前面的校验。

这个请求功能是关闭某个任务id，status 1 更新成 2 。

程序里面针对数据库的操作也是进行预处理的。类似下面：

```
db.where(task{id:id}).updata({status:2})
```
结果这个框架在id是`""`时

```
db.where(task{id:""}).updata({status:2})
```

对数据库是全量更新status为2， 这个就导致数据库被刷库了一次全部更新了。

### 故障解决
解决方案只有找DBA的同学恢复数据了（最后解决了，不然要跑路了）。

不过在恢复数据时也不是那么顺利，期间还特意问到，数据库是否有事务操作，因为涉及到事务，也会增加难度。当时还好业务都在尽量避免长事务。

### 问题原因
程序上针对数据库的写入操作保护不够。

因为在写业务时，经常因为时间紧，导致思考的主要是业务流程上的问题，会忽略一些基础的操作。也不可能让每个写业务的都实时关注数据库可能的隐患。

所以像这种写操作，暴露给业务的，就应该是一个比较安全的接口。

例如针对上面问题，可以合理在封装一层。控制下写数据的影响面。像这种全表操作的，在封装层就应该拒接掉。
