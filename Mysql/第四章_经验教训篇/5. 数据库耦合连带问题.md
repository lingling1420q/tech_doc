## 故障描述
一个边缘业务，偶然的不规范压测，导致核心业务宕机。

## 问题原因
在设计初期，各个业务都在一个数据库实例上面部署自己的数据库。也没有针对核心业务和非核心业务做拆分。导致非核心业务的不规范操作，影响了核心业务。

非核心业务的特点就是投入不是那么大，其实针对核心业务，其实平时架构都在不断优化和完善，比如限流，数据库熔断等待。再加上基础服务重要，可能平时都在不断防护各个环节的影响。

但是非核心业务，可能就是会忽视这一点，例如缺少限流，然后加上一些不规则的操作，就会导致数据库连接被占满。然后影响了同时在一个实例上的其他重要数据库。

这次导致的原因就是，上游针对非核心业务压测，压测涉及到删和增2个操作，这两个操作在一个事务里面。压测的时候导致死锁。死锁后，后面请求不断挤压，导致服务连接被打满。资源耗尽。

## 经验教训
针对核心服务，高并发的，数据库最好需要独享一个实例，避免被猪队友影响。
如果没有足够资源，也需要把核心服务和非核心服务区分开来。